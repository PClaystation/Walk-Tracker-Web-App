<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walk Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="/Walk-Tracker-Web-App/style.css">
    <link rel="manifest" href="/Walk-Tracker-Web-App/manifest.json">
</head>
<body>
    <div id="map"></div>

    <div class="input-container">
        <label for="podcast-input">Podcast Name:</label>
        <input type="text" id="podcast-input" placeholder="Enter Podcast Name">
        <button id="save-walk">Save Walk</button>
        <button id="undo-btn">Undo</button>
    </div>

    <div id="walk-history">
        <h3>Walk History</h3>
        <ul id="history-list">
            <!-- Walk history will appear here -->
        </ul>
    </div>

    <button id="clear-paths">Clear Paths</button>
    <button id="toggleTracking">Start Tracking</button>
    <button id="logoutButton">Logout</button>

    <!-- üî• Login & Signup Popup -->
    <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);"></div>

    <div id="authPopup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px;">
        <h3 id="authTitle">Login</h3>
        <form id="authForm">
            <label for="email">Email:</label>
            <input type="email" id="email" required>
            <label for="password">Password:</label>
            <input type="password" id="password" required>
            <button type="submit" id="authButton">Login</button>
        </form>
        <p>
            <span id="toggleText">Don't have an account?</span>
            <button onclick="toggleAuthMode()">Sign Up</button>
        </p>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="/Walk-Tracker-Web-App/script.js"></script>

    <script>
        let isLoginMode = true;

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById("authTitle").textContent = isLoginMode ? "Login" : "Sign Up";
            document.getElementById("authButton").textContent = isLoginMode ? "Login" : "Sign Up";
            document.getElementById("toggleText").textContent = isLoginMode ? "Don't have an account?" : "Already have an account?";
        }

        document.getElementById("authForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            const endpoint = isLoginMode ? "/api/auth/login" : "/api/auth/register";

            try {
                const response = await fetch(endpoint, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem("authToken", data.token);
                    console.log("‚úÖ Authentication successful!");
                    document.getElementById("authPopup").style.display = "none";
                    document.getElementById("overlay").style.display = "none";
                } else {
                    console.error("‚ùå Authentication failed:", data.message);
                }
            } catch (error) {
                console.error("‚ö†Ô∏è Error:", error);
            }
        });
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/Walk-Tracker-Web-App/service-worker.js')
                .then((registration) => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch((error) => {
                    console.error('Service Worker registration failed:', error);
                });
            });
        }
    </script>

    <script>
        if (window.matchMedia('(display-mode: standalone)').matches) {
            if (!location.pathname.startsWith('/Walk-Tracker-Web-App/')) {
                location.href = '/Walk-Tracker-Web-App/';
            }
        }
    </script>
</body>
</html>
